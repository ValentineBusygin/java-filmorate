DROP TABLE IF EXISTS users, friendships, films, filmGenres, filmLikes
 CASCADE;

CREATE TABLE IF NOT EXISTS users
(
 id  BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
 email    VARCHAR(60) NOT NULL,
 login    VARCHAR(60) NOT NULL,
 name     VARCHAR(60) NOT NULL,
 birthday DATE        NOT NULL
);

CREATE TABLE IF NOT EXISTS friendships
(
 user_id   BIGINT REFERENCES users (id) ON DELETE CASCADE,
 friend_id BIGINT REFERENCES users (id) ON DELETE CASCADE,
 friendship_state INTEGER,
 PRIMARY KEY (user_id, friend_id)
);

CREATE TABLE IF NOT EXISTS genres
(
 id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
 name VARCHAR(60) NOT NULL
);

CREATE TABLE IF NOT EXISTS mpaRatings (
  id    BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name  VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS films
(
 id      BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
 name         VARCHAR(60)  NOT NULL,
 description  VARCHAR(200) NOT NULL,
 release_date DATE         NOT NULL,
 duration     INTEGER      NOT NULL,
 mparating_id       BIGINT REFERENCES mpaRatings (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS filmGenres
(
 genre_id BIGINT REFERENCES genres (id) ON DELETE CASCADE,
 film_id  BIGINT REFERENCES films (id) ON DELETE CASCADE,
 PRIMARY KEY (film_id, genre_id)
);

CREATE TABLE IF NOT EXISTS filmLikes
(
 film_id BIGINT REFERENCES films (id) ON DELETE CASCADE,
 user_id BIGINT REFERENCES users (id) ON DELETE CASCADE
);